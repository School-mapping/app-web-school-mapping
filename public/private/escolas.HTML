<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Escolas</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="../css/dash.css" />
    <link rel="stylesheet" href="../css/escolas.css" />
    <link rel="stylesheet" href="../css/perfil.css">
    <script src="../js/modal.js"></script>
    <script src="../js/dashPorEscola.js"></script>
    <link rel="stylesheet" href="../css/modal.css">


</head>

<body>

    <aside class="barraLateral-esquerda">
        <img src="../assets/user.png" alt="" class="iconepessoa" />
        <div class="conteudo-central">

            <span id="nomeUser"></span>
            <span id="nomeEmpresa"></span>

            <nav class="menu-lateral">
                <a href="./dash.html" class="btn-menu">Home</a>
                <a href="./escolas.HTML" class="btn-menu">Escolas</a>
                <a href="./empresas.html" id="btn-empresa" class="btn-menu">Empresas</a>
                <a href="./configuracao.html" class="btn-menu">Configuração</a>
                <!-- <a href="./perfil.html" class="btn-menu">Perfil</a> -->
                <a href="chamados.html" class="btn-menu">Chamados</a>
                <a href="./listaNotificacoes.html" class="btn-menu">Lista Notificações</a>
                <a href="./criarNotificacoes.html" class="btn-menu">Criar Notificação</a>

                <div id="modalChamado" class="modal" style="display:none;">
                    <div class="modal-content">
                        <span class="close" onclick="fecharModal()">&times;</span>
                        <h2>Suporte Digital</h2>

                        <form>
                            <label for="nome" aria-placeholder="Insira seu nome">Nome:</label>
                            <input type="text" id="nome" name="nome" required>

                            <label for="assunto">Assunto:</label>
                            <input type="text" id="assunto" name="assunto" required>

                            <label for="descricao">Descrição:</label>
                            <textarea id="descricao" name="descricao" required></textarea>

                            <label for="tipo">Tipo:</label>
                            <select id="tipo" name="tipo" required>
                                <option value="">Selecione uma opção</option>
                                <option value="erro_dash">Erro de dashboard</option>
                                <option value="inconsistencia_dados">Inconsistência de Dados</option>
                                <option value="erro_graficos">Erro no Painel de Gráficos</option>
                                <option value="erro_slack">Erro do Slack</option>
                                <option value="erro_escolas">Erro no Painel de Escolas</option>
                            </select>

                            <button type="submit">Enviar</button>
                        </form>
                    </div>
                </div>
                <a class="btn-menu" onclick="logout()">Sair</a>
            </nav><ss="sair-section">

        </div>
    </aside>

    <main class="conteudo">
        <header class="classHitorico">
            <span>
                <a href="dash.html">Visão Geral Municipal (IDEB)</a> >
                <a href="escolas.HTML">Escolas</a>
            </span>
        </header>

        <section class="classPainelEscolas">
            <h1 class="titleEscolas">Lista de Escolas do Município - Maior ao menor IDEB</h1>

            <div class="listaEscolas">
                <table>
                    <thead>
                        <tr>
                            <th>Nome da Escola</th>
                            <th>Código INEP</th>
                            <th>IDEB</th>
                            <th>Endereço</th>
                            <th>CEP</th>
                        </tr>
                    </thead>
                    <tbody id="tbody_content" class="corpoEscolas">

                    </tbody>
                </table>
            </div>
        </section>
    </main>
</body>

<Script>
    window.onload = function () {
        carregarNome();
        carregarPerfil();
        listarEscolas();
    };
</Script>

<script>

    function carregarNome() {
        nomeUser.innerHTML = sessionStorage.USUARIO;
    }

    function carregarPerfil() {

        var id = sessionStorage.ID_USUARIO;

        fetch(`/perfil/carregarPerfil/${id}`, {
            method: "GET",
            cache: "no-store",
            headers: {
                "Content-Type": "application/json",
            }
        })
            .then(function (resposta) {

                if (resposta.ok) {
                    console.log('Busquei informações do perfil', resposta)
                    return resposta.json();

                } else {
                    throw "Erro ao buscar dados no data base";
                }
            })
            .then(function (perfilUser) {
                console.log(perfilUser[0].id_perfil)
                console.log(perfilUser[0].razao_social)
                nomeEmpresa.innerHTML = perfilUser[0].razao_social;

                if (perfilUser[0].id_perfil == 1) {
                    document.getElementById("btn-empresa").style.display = "none";
                } else {
                    document.getElementById("btn-empresa").style.display = "block";
                }
            })
            .catch(function (resposta) {
                console.log(`#ERRO: ${resposta}`);
            });
    }

    function logout() {
        sessionStorage.clear();
        window.location = "../login.html";
    }
</script>

</html>