<!DOCTYPE html>
<html lang="pt-br">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Estatísticas - School Mapping</title>
  <link rel="stylesheet" href="./css/dash.css" />
  <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body onload="carregarNome()">
  <div class="dashboard">
<aside class="barraLateral-esquerda">
    <img src="./assets/user.png" alt="" class="iconepessoa"/>
    <span id="nomeUser"></span>
      <div class="conteudo-central">

        <nav class="menu-lateral">
          <a href="dash.html" class="btn-menu">Home</a>
          <a href="private/escolas.HTML" class="btn-menu">Escolas</a>
          <a href="configuracao.html" class="btn-menu">Configuração</a>
        </nav><ss="sair-section">
                      <!-- Fechar seção -->
          <a href="#" class="btn-menu">Sair</a>

      </div>
    </aside>

    <main class="conteudo">
      <div class="cabecalho">
        <h1>Visão Geral Municipal (IDEB)</h1>

      </div>
      <div class="linha-graficos">
        <div class="kpis">
          <div class="grafico kpi">teste</div>
          <div class="grafico kpi">teste</div>
          <div class="grafico kpi">teste 2</div>
          <div class="grafico kpi">teste</div>
        </div>
        <div class="grafico">
          <canvas id="graficoBarras"></canvas>
        </div>
      </div>
      <div class="linha-graficos">
        <div class="grafico">
          <h2 style="font-weight: 200; color: gray; font-size: 15px;">
            Mapa de Calor do IDEB por Estado
          </h2>
          <div id="mapaCalorGeo" style="width: 100%; height: 100%;"></div>

        </div>
        <div class="grafico">
          <canvas id="graficoBarras2"></canvas>
        </div>
      </div>
    </main>

    <aside class="barraLateral-direita">
        <div class="notificacoes">
  <div class="notificacao" style="color: red;">Novo IDEB! </div>
  <div class="notificacao" style="color: blue;">Repasse Financeiro novo</div>
  <div class="notificacao" style="color: green;">Aumento de 2.2 no IDEB</div>
  <!-- <div class="notificacao">4</div>
  <div class="notificacao">5</div>
  <div class="notificacao">6</div>
  <div class="notificacao">7</div>
  <div class="notificacao">8</div> -->
</div>


    </aside>
  </div>
</body>
</div>

  <div cla
</html>

<script>
  function carregarNome() {
    nomeUser.innerHTML = sessionStorage.USUARIO;
  }
</script>
<script>
  const ctx = document.getElementById('graficoBarras');

  new Chart(ctx, {
    type: 'bar',
    data: {
      labels: ['Zona Sul', 'Zona Leste', 'Zona Oeste', 'Zona Norte', 'Centro'],
      datasets: [{
        label: 'IDEB (2023)',
        data: [6.8, 7.6, 6.3, 5.3, 8.5],
        backgroundColor: '#4600C2',
        borderRadius: 6,
        borderSkipped: false
      }, {
        label: 'IDEB (2025)',
        data: [6.2, 7.0, 5.3, 3.3, 8.0],
        backgroundColor: '#000AC2',
        borderRadius: 6,
        borderSkipped: false
      }]
    },
    options: {
      grouped: true,
      responsive: true,
      maintainAspectRatio: false,
      plugins: {
        title: { display: true, text: 'Média do IDEB por zona em comparação ao ano anterior' },
        legend: { display: true },

        tooltip: { mode: 'index', intersect: false }
      },
      scales: {
        x: {
          grid: { display: false }
        },
        y: {
          beginAtZero: true,
          grid: { color: 'rgba(0,0,0,0.06)' },
          ticks: { precision: 0 }
        }
      }
    }
  });

  const ctxBarras2 = document.getElementById('graficoBarras2');

  const config = {
    type: 'bar',
    data: {
      labels: ['Zona Sul', 'Zona Leste', 'Zona Oeste', 'Zona Norte', 'Centro'],
      datasets: [
        {
          label: 'Nota média (IDEB)',
          data: [6.2, 7.0, 5.3, 3.3, 8.0],
          backgroundColor: '#4600C2',
          borderRadius: 6,
        },
        {
          label: 'Verba (R$ milhões)',
          data: [-62, -70, -53, -33, -80],
          backgroundColor: '#000AC2',
          borderRadius: 6,
        }
      ]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      indexAxis: 'y',
      plugins: {
        title: {
          display: true,
          text: 'Comparação de verba e notas por zona'
        },
        tooltip: {
          callbacks: {
            label: function (context) {
              let label = context.dataset.label || '';
              if (label) {
                label += ': ';
              }
              label += Math.abs(context.parsed.x);
              return label;
            }
          }
        }
      },
      scales: {
        x: {
          offset: false,
          ticks: {
            callback: function (value, index, values) {
              return Math.abs(value);
            }
          },
          title: {
            display: true,
            text: 'Valor'
          },
          grid: {
            display: true,
            drawOnChartArea: true,
            drawTicks: true,
            color: function (context) {
              if (context.tick.value === 0) {
                return 'rgba(0, 0, 0, 0.6)';
              }
              return 'rgba(0, 0, 0, 0.1)';
            }
          },
          min: -85,
          max: 85,
        },
        y: {
          stacked: true,
          title: {
            display: true,
            text: 'Zonas'
          },
          grid: {
            drawOnChartArea: false,
            drawTicks: true
          }
        }
      }
    }
  };

  const myChart = new Chart(ctxBarras2, config);

</script>
<script async defer
  src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDZDPpXaJeeEDVazesF8nBZONca1a8cwbE&callback=initMap"></script>
<script>
  async function initMap() {

    try {

      const response = await fetch("./geojsons/subprefeituras-sp.geojson");
      if (!response.ok) {
        throw new Error('Não foi possível carregar o GeoJSON!');
      }

      const bounds = new google.maps.LatLngBounds(
        new google.maps.LatLng(-24.20, -47.00),
        new google.maps.LatLng(-23.30, -46.20)
      );

      const geojson = response.json();

      const mapOptions = {
        zoom: 9,
        center: { lat: -23.55, lng: -46.63 },
        mapTypeId: google.maps.MapTypeId.SATELLITE,
        disableDoubleClickZoom: true,
        streetViewControl: false,
        mapTypeControl: false,
        restriction: {
          latLngBounds: bounds,
          strictBounds: false,
        },
        labels: false
      };

      var map = new google.maps.Map(document.getElementById('mapaCalorGeo'), mapOptions);

      map.data.loadGeoJson("./geojsons/subprefeituras-sp.geojson");
      map.data.setStyle(feature => {
        const ideb = parseFloat(feature.getProperty('ideb'));
        let cor;
        if (ideb < 6.5) {
          cor = '#FF0000'; // vermelho
        } else if (ideb < 8.3) {
          cor = '#FFA500'; // laranja
        } else {
          cor = '#00FF00'; // verde
        }
        return {
          fillColor: cor,
          strokeWeight: 1,
          fillOpacity: 0.85,
          strokeColor: '#333',
        };
      });

      map.data.addListener("click", function (event) {
        const nome = event.feature.getProperty("name");
        const ideb = event.feature.getProperty("ideb");

        const infoWindow = new google.maps.InfoWindow({
          content: `
          <div style="font-size:16px; font-weight:bold;">${nome}</div>
          <div style="margin-top:8px;">IDEB: ${ideb}</div>
          <div>Meta: 7.5</div>
          `,
          position: event.latLng
        });
        infoWindow.open(map);
      });
    } catch (error) {
      console.error(error);
    }
  }
</script>