<!DOCTYPE html>
<html lang="pt-br">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Estatísticas - School Mapping</title>
  <link rel="stylesheet" href="./css/dash.css" />
  <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>
  <div class="dashboard">
    <aside class="barraLateral-esquerda">
      <img src="./assets/user.png" alt="" class="iconepessoa" />

      <div class="conteudo-central">

        <nav class="menu-lateral">
          <div class="btn-menu" style="display: flex; flex-direction: row; align-items: center;">
            <img src="./assets/home_icon.png" style="width: 25px; height: 25px; margin-right: 4px" />
            <a href="index.html">Home</a>
          </div>

          <div class="btn-menu" style="display: flex; flex-direction: row; align-items: center;">
            <img src="assets/config_icon.png" style="width: 25px; height: 25px; margin-right: 4px">
            <a href="configuracao.html">Configuração</a>
          </div>
        </nav><ss="sair-section">
          <div class="btn-menu" style="display: flex; flex-direction: row; align-items: center;">
            <img src="assets/logout_icon.png" style="width: 25px; height: 25px; margin-right: 4px">
            <a href="index.html">Sair</a>
          </div>

      </div>
    </aside>

    <main class="conteudo">
      <div class="linha-graficos">
        <div class="grafico" style="width: 300px; height: 300px;">
          <h2 style="font-weight: 200; color: gray; font-size: 15px;">
            Mapa de Calor do IDEB por Estado
          </h2>
          <div id="mapaCalorGeo"></div>

        </div>
        <div class="grafico">
          <canvas id="graficoBarras"></canvas>
        </div>
      </div>
      <div class="linha-graficos">
        <div class="grafico">
          <canvas id="graficoLinha"></canvas>
        </div>
        <div class="grafico">
          <canvas id="graficoPizza"></canvas>
        </div>
      </div>
    </main>
  </div>
</body>
</div>

<div cla </html>
  <script>
    const ctx = document.getElementById('graficoBarras');

    new Chart(ctx, {
      type: 'bar',
      data: {
        labels: ['Zona Sul', 'Zona Leste', 'Zona Oeste', 'Zona Norte', 'Centro'],
        datasets: [{
          label: 'IDEB',
          data: [6.2, 7.0, 5.3, 3.3, 8.0],
          backgroundColor: '#2c0475',
          borderRadius: 6,
          borderSkipped: false
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          title: { display: true, text: 'Média do IDEB por região' },
          legend: { display: true },

          tooltip: { mode: 'index', intersect: false }
        },
        scales: {
          x: {
            grid: { display: false }
          },
          y: {
            beginAtZero: true,
            grid: { color: 'rgba(0,0,0,0.06)' },
            ticks: { precision: 0 }
          }
        }
      }
    });

    const ctxLinha = document.getElementById('graficoLinha');

    new Chart(ctxLinha, {
      type: 'line',
      data: {
        labels: ['2020', '2021', '2022', '2023', '2024', '2025'],
        datasets: [{
          label: 'IDEB',
          data: [4, 2, 3, 6, 7, 10],
          borderColor: '#2c0475',
          backgroundColor: 'rgba(44, 4, 117, 0.5)',
          tension: 0.3,
          fill: true,
          pointRadius: 4,
          pointBackgroundColor: '#4B7BF5'
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          title: {
            display: true,
            text: 'Evolução do IDEB na Escola X ao longo dos anos'
          },
          legend: { diplay: true, position: 'bottom', labels: { boxWidth: 20, padding: 15, font: { size: 14, weight: '200' }, color: 'grey' } },
          tooltip: { callbacks: { label: ctx => `${ctx.label}: ${ctx.raw}` } }
        },
        scales: {
          x: {
            title: {
              display: true,
              text: 'Ano'
            },
            grid: {
              display: false
            }
          },
          y: {
            beginAtZero: true,
            ticks: {
              stepSize: 0.5
            },
            grid: {
              color: 'rgba(0,0,0,0.05)'
            }
          }
        }
      }
    });
    const ctxPizza = document.getElementById('graficoPizza');

    new Chart(ctxPizza, {
      type: 'bar',
      data: {
        labels: ['Zona Sul', 'Zona Leste', 'Zona Oeste', 'Zona Norte', 'Centro'],
        datasets: [{
          label: 'Verba recebida (em milhões)',
          data: [133.000, 241.000, 153.000, 135.000, 181.000],
          backgroundColor: '#2c0475',
          borderColor: '#fff',
          borderWidth: 2,
          borderRadius: 6,
          borderSkipped: false
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          title: { display: true, text: 'Verba total por região', color: 'black', font: { size: 14, weight: '400' }, },
          legend: { diplay: true, position: 'bottom', labels: { boxWidth: 20, padding: 15, font: { size: 14, weight: '200' }, color: 'grey' } },
          tooltip: { callbacks: { label: ctx => `${ctx.label}: ${ctx.raw}` } }
        },
        scales: {
          x: {
            grid: { display: false }
          },
          y: {
            beginAtZero: true,
            grid: { color: 'rgba(0,0,0,0.06)' },
            ticks: { precision: 0 }
          }
        }
      }
    });

  </script>
  <script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDZDPpXaJeeEDVazesF8nBZONca1a8cwbE&callback=initMap"></script>
  <script>
    async function initMap() {

      try {

        const response = await fetch("./geojsons/subprefeituras-sp.geojson");
        if (!response.ok) {
          throw new Error('Não foi possível carregar o GeoJSON!');
        }

        const bounds = new google.maps.LatLngBounds(
          new google.maps.LatLng(-24.20, -47.00),
          new google.maps.LatLng(-23.30, -46.20)
        );

        const geojson = response.json();

        const mapOptions = {
          zoom: 9,
          center: { lat: -23.55, lng: -46.63 },
          mapTypeId: google.maps.MapTypeId.SATELLITE,
          disableDoubleClickZoom: true,
          streetViewControl: false,
          fullscreenControl: false,
          mapTypeControl: false,
          restriction: {
            latLngBounds: bounds,
            strictBounds: false,
          },
          labels: false
        };

        var map = new google.maps.Map(document.getElementById('mapaCalorGeo'), mapOptions);

        map.data.loadGeoJson("./geojsons/subprefeituras-sp.geojson");
        map.data.setStyle(feature => {
          let nome = feature.getProperty('nome');
          var cor = nome === 'Pinheiros' ? '#FF0000' : '#00FF00';
          return {
            fillColor: cor,
            strokeWeight: 1,
            fillOpacity: 1,
            strokeColor: '#333',
          };
        });

        map.data.addListener("click", function (event) {
          const nome = event.feature.getProperty("name");

          const infoWindow = new google.maps.InfoWindow({
            content: `
          <div style="font-size:16px; font-weight:bold;">${nome}</div>
          <div style="margin-top:8px;">IDEB: 6.5</div>
          <div>Meta: 7.0</div>
          `,
            position: event.latLng
          });
          infoWindow.open(map);
        });

        map.data.addListener('mouseover', e => {
          map.data.overrideStyle(e.feature, { fillOpacity: 0.9 });
        });
        map.data.addListener('mouseout', e => {
          map.data.revertStyle();
        });
      } catch (error) {
        console.error(error);
      }
    }

  </script>